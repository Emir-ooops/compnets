# –õ–† 3. Ansible + Caddy

## –ó–∞–¥–∞—á–∞

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä Caddy –ø—Ä–∏ –ø–æ–º–æ—â–∏ Ansible Playbook, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω Jinja2, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É. –†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —Å—Ä–µ–¥–µ Ubuntu (WSL) –Ω–∞ Windows.

---

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:

sudo apt update  
sudo apt upgrade -y  

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible:

sudo apt install ansible -y  

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏:

ansible --version  

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 1 ‚Äì –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã ansible --version

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

mkdir lab3  
cd lab3  

–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞:

mkdir inventory  
mkdir roles  

–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ansible.cfg:

[defaults]  
host_key_checking = false  
inventory = inventory/hosts  

–°–æ–∑–¥–∞–Ω–∏–µ inventory/hosts:

[my_servers]  
local_server ansible_host=localhost  

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

ansible my_servers -m ping -c local  

–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äì pong.

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 2 ‚Äì —É—Å–ø–µ—à–Ω—ã–π ping (pong)

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏

cd roles  
ansible-galaxy init caddy_deploy  
cd ..  

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 3 ‚Äì —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ä–æ–ª–∏ (–ø–∞–ø–∫–∏ tasks, templates, vars –∏ —Ç.–¥.)

---

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ tasks

–§–∞–π–ª roles/caddy_deploy/tasks/main.yml –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω. –í –Ω–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã —à–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Caddy, —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–≥-—Ñ–∞–π–ª–∞, —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ GPG –∫–ª—é—á–∞ Caddy
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Caddy
- —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è /var/log/caddy_access.log —Å –Ω—É–∂–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã index.html
- –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Caddyfile
- –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

---

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–±–ª–æ–Ω–∞

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª roles/caddy_deploy/templates/Caddyfile.j2 —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

:80 {  
  root * /usr/share/caddy  
  file_server  

  log {  
    output file {{ log.file }}  
    format json  
    level {{ log.level }}  
  }  
}  

---

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–§–∞–π–ª roles/caddy_deploy/vars/main.yml:

log:  
  file: /var/log/caddy_access.log  
  level: INFO  

---

### 7. –°–æ–∑–¥–∞–Ω–∏–µ Playbook

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª caddy_deploy.yml:

- name: Install and configure Caddy  
  hosts: my_servers  
  connection: local  
  roles:  
    - caddy_deploy  

---

### 8. –ó–∞–ø—É—Å–∫ Playbook

sudo ansible-playbook caddy_deploy.yml  

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è PLAY RECAP —Å failed=0.

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 4 ‚Äì —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ playbook (PLAY RECAP)

---

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

–í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:

http://localhost  

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:

Hello from Ansible Lab 3

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 5 ‚Äì —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

### 10. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

sudo tail -n 20 /var/log/caddy_access.log  

–í —Ñ–∞–π–ª–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è JSON-–∑–∞–ø–∏—Å–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.

üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç 6 ‚Äì –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤

---

## –í—ã–≤–æ–¥

–í —Ö–æ–¥–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Ansible, —Å–æ–∑–¥–∞–Ω–∞ —Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ Caddy, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω Jinja2 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞. Playbook –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫, –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.